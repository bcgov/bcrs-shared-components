var w=Object.defineProperty;var L=(a,t,e)=>t in a?w(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var o=(a,t,e)=>(L(a,typeof t!="symbol"?t+"":t,e),e);import{A as f}from"./index-2b7fa976.js";import{M as T}from"./index-7a7a5d4b.js";import{m as $,C as D,P as i,n as k}from"./_plugin-vue2_normalizer-b11a0120.js";import{D as P}from"./validation-mixin-e5d1d708.js";import"./_commonjsHelpers-de833af9.js";import"./vue.esm-b1e57a2f.js";import"./lodash-f6b38868.js";var j=Object.defineProperty,I=Object.getOwnPropertyDescriptor,m=(a,t,e,s)=>{for(var n=s>1?void 0:s?I(t,e):t,c=a.length-1,u;c>=0;c--)(u=a[c])&&(n=(s?u(t,e,n):u(n))||n);return s&&n&&j(t,e,n),n};let r=class extends $(P){constructor(){super(...arguments);o(this,"$refs");o(this,"axios");o(this,"businessId");o(this,"url");o(this,"nudgeTop");o(this,"nudgeLeft");o(this,"maxLength");o(this,"showComments",!1);o(this,"comments",[]);o(this,"comment",null);o(this,"isSaving",!1)}get charsRemaining(){const e=this.comment?this.comment.length:0;return this.maxLength-e}get numComments(){const e=this.comments.length;return e===1?"1 Comment":`${e} Comments`}get rules(){return[e=>e&&e.trim().length>0||"Enter a comment.",e=>e&&e.length<=this.maxLength||"Maximum characters reached."]}get getUrl(){return this.url||`businesses/${this.businessId}/comments`}async created(){await this.fetchStaffComments()}async fetchStaffComments(){this.comments=await this.axios.get(this.getUrl).then(e=>{const s=e&&e.data&&e.data.comments||[];return Array.isArray(s)&&s[0]&&typeof s[0].comment=="string"?s:this.flattenAndSortComments(s)}).catch(()=>[])}async save(){if(!this.$refs.textarea.validate()||this.isSaving)return;this.isSaving=!0;const e={comment:{businessId:this.businessId,comment:this.comment}};let s=!1;await this.axios.post(this.getUrl,e).then(n=>{s=!0}).catch(n=>{console.log("save() error =",n),alert("Could not save your comment. Please try again or cancel.")}),this.isSaving=!1,s&&(this.$refs.textarea.reset(),await this.fetchStaffComments())}close(){this.$refs.textarea.resetValidation(),this.showComments=!1}flattenAndSortComments(e){if(e&&e.length>0){const s=e.map(n=>n.comment);return s.sort((n,c)=>new Date(n.timestamp)<new Date(c.timestamp)?1:-1),s}return[]}};m([i({required:!0})],r.prototype,"axios",2);m([i({required:!0})],r.prototype,"businessId",2);m([i({default:null})],r.prototype,"url",2);m([i({default:33})],r.prototype,"nudgeTop",2);m([i({default:20})],r.prototype,"nudgeLeft",2);m([i({default:4096})],r.prototype,"maxLength",2);r=m([D({})],r);var O=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"d-inline",attrs:{id:"staff-comments"}},[e("v-menu",{attrs:{bottom:"",attach:"#staff-comments","nudge-top":t.nudgeTop,"nudge-left":t.nudgeLeft,"close-on-click":!1,"close-on-content-click":!1},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:n}){return[e("v-btn",t._g(t._b({attrs:{id:"comments-button",small:"",text:"",color:"primary"}},"v-btn",n,!1),s),[e("v-icon",{attrs:{medium:""}},[t._v(" mdi-comment-text-outline ")]),e("span",[t._v(t._s(t.numComments))])],1)]}}]),model:{value:t.showComments,callback:function(s){t.showComments=s},expression:"showComments"}},[e("v-card",{staticClass:"px-8 py-6",attrs:{id:"staff-comment-container",flat:""}},[e("v-card-title",{staticClass:"d-flex justify-space-between pa-0"},[e("div",[e("v-icon",{attrs:{medium:"",color:"primary"}},[t._v(" mdi-comment-text-outline ")]),e("span",[t._v(t._s(t.numComments))])],1),e("v-btn",{staticClass:"mr-n3",attrs:{id:"close-button",icon:"",large:""},on:{click:function(s){return t.close()}}},[e("v-icon",{attrs:{color:"primary"}},[t._v(" mdi-close ")])],1)],1),e("v-card-text",{staticClass:"mt-2 pa-0"},[e("v-textarea",{ref:"textarea",attrs:{autofocus:"","no-resize":"",filled:"",rows:"5",placeholder:"Enter Comments",rules:t.rules},model:{value:t.comment,callback:function(s){t.comment=s},expression:"comment"}})],1),e("v-card-actions",{staticClass:"d-flex justify-space-between pa-0"},[e("div",{staticClass:"text-body-2 mt-1"},[t._v(" "+t._s(t.charsRemaining)+" ")]),e("div",{staticClass:"mr-n3"},[e("v-btn",{staticClass:"font-weight-bold",attrs:{id:"save-button",text:"",color:"primary",loading:t.isSaving},on:{click:function(s){return t.save()}}},[t._v(" Save ")]),e("v-btn",{attrs:{id:"cancel-button",text:"",color:"primary"},on:{click:function(s){return t.close()}}},[t._v(" Cancel ")])],1)]),e("v-card-text",{staticClass:"mt-6 pa-0"},[e("div",{staticClass:"pr-5",attrs:{id:"existing-comments"}},t._l(t.comments,function(s,n){return e("div",{key:n,staticClass:"text-body-2"},[e("p",{staticClass:"pre-line",domProps:{innerHTML:t._s(s.comment)}}),e("p",{staticClass:"font-italic"},[t._v(" "+t._s(s.submitterDisplayName)+" ‐ "+t._s(t.apiToPacificDateTime(s.timestamp))+" ")])])}),0)])],1)],1)],1)},U=[],_=k(r,O,U,!1,null,"b012b43d",null,null);const A=_.exports;_.exports.__docgenInfo={description:`This is a local, minimal mixin containing only the methods needed for the shared
components when they run within this project (ie, in Storybook).

When imported into an app project, the shared components should use the mixins
local to that project.`,tags:{},exportName:"default",displayName:"StaffComments",props:[{name:"axios",tags:{},type:{name:"any"},required:!0},{name:"businessId",tags:{},type:{name:"string"},required:!0},{name:"url",tags:{},type:{name:"string"},defaultValue:{func:!1,value:"null"}},{name:"nudgeTop",tags:{},type:{name:"number"},defaultValue:{func:!1,value:"33"}},{name:"nudgeLeft",tags:{},type:{name:"number"},defaultValue:{func:!1,value:"20"}},{name:"maxLength",tags:{},type:{name:"number"},defaultValue:{func:!1,value:"4096"}}],sourceFiles:["/Users/work/repos/bcrs-shared-components/src/components/staff-comments/StaffComments.vue","/Users/work/repos/bcrs-shared-components/src/mixins/date-mixin.ts"]};const G={title:"component/StaffComments"},x=[{comment:{comment:"First comment.",submitterDisplayName:"Tester",timestamp:"2019-06-02T19:22:59.003777+00:00"}}],C=new T(f);C.onGet().reply(200,{comments:x});C.onPost().reply(a=>{const t=JSON.parse(a.data).comment;return x.push({comment:{comment:t.comment,submitterDisplayName:"You",timestamp:new Date().toISOString().replace("Z","+00:00")}}),[201,{comment:t}]});const S=(a,{argTypes:t})=>({props:Object.keys(t),components:{StaffComments:A},template:`
    <div class="mt-10 ml-10">
      <staff-comments v-bind="$props" />
    </div>
    `}),l=S.bind({});l.args={axios:f.create(),businessId:"CP1234567",maxLength:2e3};const p=S.bind({});p.args={axios:f.create(),businessId:"RS001",maxLength:2e3,URL:"test.com"};var d,h,v;l.parameters={...l.parameters,docs:{...(d=l.parameters)==null?void 0:d.docs,source:{originalSource:`(args, {
  argTypes
}) => ({
  props: Object.keys(argTypes),
  components: {
    StaffComments
  },
  // $props comes from args below
  template: \`
    <div class="mt-10 ml-10">
      <staff-comments v-bind="$props" />
    </div>
    \`
})`,...(v=(h=l.parameters)==null?void 0:h.docs)==null?void 0:v.source}}};var g,b,y;p.parameters={...p.parameters,docs:{...(g=p.parameters)==null?void 0:g.docs,source:{originalSource:`(args, {
  argTypes
}) => ({
  props: Object.keys(argTypes),
  components: {
    StaffComments
  },
  // $props comes from args below
  template: \`
    <div class="mt-10 ml-10">
      <staff-comments v-bind="$props" />
    </div>
    \`
})`,...(y=(b=p.parameters)==null?void 0:b.docs)==null?void 0:y.source}}};const H=["Default","StaffCommentsWithURL"];export{l as Default,p as StaffCommentsWithURL,H as __namedExportsOrder,G as default};
//# sourceMappingURL=StaffComments.stories-be583143.js.map
