{"version":3,"file":"validation-mixin-aac6b4a2.js","sources":["../../src/enums/name-request-codes.ts","../../src/enums/name-request-states.ts","../../src/mixins/date-mixin.ts","../../src/mixins/name-request-mixin.ts","../../src/mixins/countries-provinces-mixin.ts","../../src/mixins/validation-mixin.ts"],"sourcesContent":["//\r\n// Various codes found in NR objects.\r\n// (may be sorted by code)\r\n//\r\n\r\n// ref: https://github.com/bcgov/namex/blob/main/api/namex/constants/__init__.py\r\n// ref: https://github.com/bcgov/lear/blob/main/legal-api/src/legal_api/resources/v1/nr_type_map.py\r\nexport enum NrRequestTypeCodes {\r\n  // change name (or resubmit)\r\n  CHANGE_BEN = 'BEC',\r\n  CHANGE_CCC = 'CCC',\r\n  CHANGE_COOP = 'CCP',\r\n  CHANGE_CORP = 'CCR', // BC Limited\r\n  CHANGE_FIRM = 'CFR', // SP, DBA or GP\r\n  CHANGE_ULC = 'CUL',\r\n\r\n  // continuation in (move or resubmit)\r\n  CONTINUATION_IN_BEN = 'BECT',\r\n  CONTINUATION_IN_CCC = 'CCCT',\r\n  CONTINUATION_IN_COOP = 'CTC',\r\n  CONTINUATION_IN_CORP = 'CT',\r\n  CONTINUATION_IN_ULC = 'ULCT',\r\n\r\n  // convert (or resubmit)\r\n  CONVERT_BEN = 'BECV', // from LTD to BEN\r\n  CONVERT_CCC = 'CCV', // from LTD to CCC\r\n  CONVERT_CORP = 'BECR', // from BEN to LTD\r\n  CONVERT_ULBE = 'ULBE', // from ULC to BEN\r\n  CONVERT_ULC = 'UC', // from LTD to ULC\r\n  CONVERT_ULCB = 'ULCB', // from ULC to LTD\r\n\r\n  // new (or resubmit)\r\n  NEW_BC = 'BC', // BC Benefit Company Incorporation\r\n  NEW_CCC = 'CC', // CCC - Incorporation/Amalgamation\r\n  NEW_COOP = 'CP', // Cooperative - Incorporation/Amalgamation\r\n  NEW_CORP = 'CR', // BC Company - Incorporation/Amalgamation\r\n  NEW_FIRM = 'FR', // Sole Proprietorship/General Partnership/DBA - Registration\r\n  NEW_ULC = 'UL', // Unlimited Liability Company\r\n  NEW_XPRO_CORP = 'XCR', // Corporation (Foreign) - Extrapro Registration/Amalgamation\r\n\r\n  // restoration\r\n  RESTORATION_CCC = 'RCC',\r\n  RESTORATION_COOP = 'RCP',\r\n  RESTORATION_CORP = 'RCR', // BC Limited\r\n  RESTORATION_SOC = 'RSO',\r\n  RESTORATION_BEN = 'BERE',\r\n  RESTORATION_ULC = 'RUL',\r\n\r\n  // others, may be legacy or future\r\n  LC = 'LC', // new XPRO_LL_PARTNR\r\n  CLC = 'CLC', // change XPRO_LL_PARTNR\r\n  RLC = 'RLC', // restoration XPRO_LL_PARTNR\r\n  AL = 'AL', // assumed name XPRO_LL_PARTNR\r\n  LL = 'LL', // new LL_PARTNERSHIP\r\n  CLL = 'CLL', // change LL_PARTNERSHIP\r\n  XLL = 'XLL', // new XPRO_LL_PARTNR\r\n  XCLL = 'XCLL', // change XPRO_LL_PARTNR\r\n  LP = 'LP', // new LIM_PARTNERSHIP\r\n  CLP = 'CLP', // change LIM_PARTNERSHIP\r\n  SO = 'SO', // new SOCIETY\r\n  ASO = 'ASO', // amlagamate SOCIETY\r\n  CSO = 'CSO', // change SOCIETY\r\n  RSO = 'RSO', // restoration SOCIETY\r\n  CTSO = 'CTSO', // move SOCIETY\r\n  CSSO = 'CSSO', // convert SOCIETY\r\n  XSO = 'XSO', // new XPRO_SOCIETY\r\n  XCSO = 'XCSO', // change XPRO_SOCIETY\r\n  XRSO = 'XRSO', // restoration XPRO_SOCIETY\r\n  XASO = 'XASO', // assumed name XPRO_SOCIETY\r\n  XCASO = 'XCASO', // achg XPRO_SOCIETY\r\n  XCP = 'XCP', // new XPRO_COOP\r\n  XCCP = 'XCCP', // change XPRO_COOP\r\n  XRCP = 'XRCP', // restoration XPRO_COOP\r\n  FI = 'FI', // new FINANCIAL\r\n  CFI = 'CFI', // change FINANCIAL\r\n  RFI = 'RFI', // restoration FINANCIAL\r\n  PA = 'PA', // new PRIVATE_ACT\r\n  PAR = 'PAR', // new PARISHES\r\n  BEAM = 'BEAM', // amalgamate BCOMP\r\n}\r\n\r\nexport enum NrRequestActionCodes {\r\n  AMALGAMATE = 'AML',\r\n  ASSUMED = 'ASSUMED', // FUTURE: should be AS (as in LEAR)?\r\n  CHANGE_NAME = 'CHG',\r\n  CONVERSION = 'CNV',\r\n  DBA = 'DBA', // doing business as\r\n  MOVE = 'MVE', // continuation in\r\n  NEW_BUSINESS = 'NEW', // incorporate or register\r\n  RESTORE = 'REH', // restore or reinstate\r\n  RENEW = 'REN', // restore with new name request\r\n  RESTORATION = 'REST', // FUTURE: unused? delete?\r\n  RESUBMIT = 'RESUBMIT', // FUTURE: unused? delete?\r\n\r\n  INFO = 'INFO' // special value for sub-menu\r\n}\r\n","export enum NameRequestStates {\r\n  // API STATES\r\n  APPROVED = 'APPROVED',\r\n  CANCELLED = 'CANCELLED',\r\n  COMPLETED = 'COMPLETED',\r\n  CONDITIONAL = 'CONDITIONAL', // NR state\r\n  CONDITION = 'CONDITION', // NR name state\r\n  CONSUMED = 'CONSUMED',\r\n  DRAFT = 'DRAFT',\r\n  EXPIRED = 'EXPIRED',\r\n  HISTORICAL = 'HISTORICAL',\r\n  HOLD = 'HOLD',\r\n  INPROGRESS = 'INPROGRESS',\r\n  PENDING_PAYMENT = 'PENDING_PAYMENT',\r\n  REFUND_REQUESTED = 'REFUND_REQUESTED',\r\n  REJECTED = 'REJECTED',\r\n  NRO_UPDATING = 'NRO_UPDATING',\r\n\r\n  // ADDITIONAL UI STATES FOR ERROR HANDLING\r\n  NOT_APPROVED = 'NOT_APPROVED',\r\n  NOT_FOUND = 'NOT_FOUND',\r\n  NEED_CONSENT = 'NEED_CONSENT',\r\n  INVALID = 'INVALID'\r\n}\r\n","import Vue from 'vue'\r\nimport { Component } from 'vue-property-decorator'\r\nimport { isDate } from 'lodash'\r\nimport { ApiDateTimeUtc, IsoDatePacific } from '@bcrs-shared-components/interfaces'\r\n\r\n/**\r\n * This is a local, minimal mixin containing only the methods needed for the shared\r\n * components when they run within this project (ie, in Storybook).\r\n *\r\n * When imported into an app project, the shared components should use the mixins\r\n * local to that project.\r\n */\r\n@Component({\r\n  extends: Vue\r\n})\r\nexport default class DateMixin extends Vue {\r\n  /**\r\n   * Creates and returns a new Date object in UTC, given parameters in Pacific timezone.\r\n   * (This works regardless of user's local clock/timezone.)\r\n   * @example \"2021, 0, 1, 0, 0\" -> \"2021-01-01T08:00:00.000Z\"\r\n   * @example \"2021, 6, 1, 0, 0\" -> \"2021-07-01T07:00:00.000Z\"\r\n   */\r\n  createUtcDate (year: number, month: number, day: number, hours = 0, minutes = 0): Date {\r\n    // 1. create the new date in UTC\r\n    // 2. compute the offset between UTC and Pacific timezone\r\n    // 3. add the offset to convert the date to Pacific timezone\r\n    // Ref: https://stackoverflow.com/questions/15141762/\r\n    const date = new Date(Date.UTC(year, month, day, hours, minutes))\r\n    const utcDate = new Date(date.toLocaleString('en-US', { timeZone: 'UTC' }))\r\n    const tzDate = new Date(date.toLocaleString('en-US', { timeZone: 'America/Vancouver' }))\r\n    const offset = utcDate.getTime() - tzDate.getTime()\r\n    date.setTime(date.getTime() + offset)\r\n\r\n    return date\r\n  }\r\n\r\n  /**\r\n   * Converts an API datetime string (in UTC) to a Date object.\r\n   * @example 2021-08-05T16:56:50.783101+00:00 -> 2021-08-05T16:56:50Z\r\n   */\r\n  apiToDate (dateTimeString: ApiDateTimeUtc): Date {\r\n    if (!dateTimeString) return null // safety check\r\n\r\n    // chop off the milliseconds and UTC offset and append \"Zulu\" timezone abbreviation\r\n    // eg, 2020-08-28T21:53:58Z\r\n    dateTimeString = dateTimeString.slice(0, 19) + 'Z'\r\n\r\n    // NB: this `new Date()` is safe because the string is already UTC format\r\n    //     so the conversion to JS Date ignores the browser's local timezone\r\n    return new Date(dateTimeString)\r\n  }\r\n\r\n  /**\r\n   * Converts a date string (YYYY-MM-DD) to a Date object at 12:00:00 am Pacific time.\r\n   * @example 2021-11-22 -> 2021-11-22T08:00:00.00Z\r\n   */\r\n  yyyyMmDdToDate (dateStr: IsoDatePacific): Date {\r\n    // safety checks\r\n    if (!dateStr) return null\r\n    if (dateStr.length !== 10) return null\r\n\r\n    const split = dateStr.split('-')\r\n    const year = +split[0]\r\n    const month = +split[1]\r\n    const day = +split[2]\r\n\r\n    return this.createUtcDate(year, (month - 1), day)\r\n  }\r\n\r\n  /**\r\n   * Converts a Date object to a date string (YYYY-MM-DD) in Pacific timezone.\r\n   * @example \"2021-01-01 07:00:00 GMT\" -> \"2020-12-31\"\r\n   * @example \"2021-01-01 08:00:00 GMT\" -> \"2021-01-01\"\r\n   */\r\n  dateToYyyyMmDd (date: Date): IsoDatePacific {\r\n    // safety check\r\n    if (!isDate(date) || isNaN(date.getTime())) return null\r\n\r\n    // NB: some versions of Node have only en-US locale\r\n    // so use that and convert results accordingly\r\n    const dateStr = date.toLocaleDateString('en-US', {\r\n      timeZone: 'America/Vancouver',\r\n      month: 'numeric', // 12\r\n      day: 'numeric', // 31\r\n      year: 'numeric' // 2020\r\n    })\r\n\r\n    // convert mm/dd/yyyy to yyyy-mm-dd\r\n    // and make sure month and day are 2 digits (eg, 03)\r\n    const [ mm, dd, yyyy ] = dateStr.split('/')\r\n    return `${yyyy}-${mm.padStart(2, '0')}-${dd.padStart(2, '0')}`\r\n  }\r\n\r\n  /**\r\n   * Converts a Date object to a date string (Month Day, Year) in Pacific timezone.\r\n   * @param longMonth whether to show long month name (eg, December vs Dec)\r\n   * @param showWeekday whether to show the weekday name (eg, Thursday)\r\n   * @example \"2021-01-01 07:00:00 GMT\" -> \"Dec 31, 2020\"\r\n   * @example \"2021-01-01 08:00:00 GMT\" -> \"Jan 1, 2021\"\r\n   */\r\n  dateToPacificDate (date: Date, longMonth = false, showWeekday = false): string {\r\n    // safety check\r\n    if (!isDate(date) || isNaN(date.getTime())) return null\r\n\r\n    // NB: some versions of Node have only en-US locale\r\n    // so use that and convert results accordingly\r\n    let dateStr = date.toLocaleDateString('en-US', {\r\n      timeZone: 'America/Vancouver',\r\n      weekday: showWeekday ? 'long' : undefined, // Thursday or nothing\r\n      month: longMonth ? 'long' : 'short', // December or Dec.\r\n      day: 'numeric', // 31\r\n      year: 'numeric' // 2020\r\n    })\r\n\r\n    // remove period after month\r\n    dateStr = dateStr.replace('.', '')\r\n\r\n    return dateStr\r\n  }\r\n\r\n  /**\r\n   * Converts a date string (YYYY-MM-DD) to a date string (Month Day, Year) in Pacific timezone.\r\n   * @param longMonth whether to show long month name (eg, December vs Dec)\r\n   * @param showWeekday whether to show the weekday name (eg, Thursday)\r\n   * @example \"2021-01-01\" -> \"Thursday, December 31, 2020\"\r\n   */\r\n  yyyyMmDdToPacificDate (dateStr: IsoDatePacific, longMonth = false, showWeekday = false): string {\r\n    return this.dateToPacificDate(this.yyyyMmDdToDate(dateStr), longMonth, showWeekday)\r\n  }\r\n\r\n  /**\r\n     * Converts a Date object to a time string (HH:MM am/pm) in Pacific timezone.\r\n     * @example \"2021-01-01 07:00:00 GMT\" -> \"11:00 pm\"\r\n     * @example \"2021-01-01 08:00:00 GMT\" -> \"12:00 am\"\r\n     */\r\n  dateToPacificTime (date: Date): string {\r\n    // safety check\r\n    if (!isDate(date) || isNaN(date.getTime())) return null\r\n\r\n    // NB: some versions of Node have only en-US locale\r\n    // so use that and convert results accordingly\r\n    let timeStr = date.toLocaleTimeString('en-US', {\r\n      timeZone: 'America/Vancouver',\r\n      hour: 'numeric', // 11\r\n      minute: '2-digit', // 00\r\n      hour12: true // a.m./p.m.\r\n    })\r\n\r\n    // replace AM with am and PM with pm\r\n    timeStr = timeStr.replace('AM', 'am').replace('PM', 'pm')\r\n\r\n    return timeStr\r\n  }\r\n\r\n  /**\r\n   * Converts an API datetime string (in UTC) to a date and time string (Month Day, Year at HH:MM am/pm\r\n   * Pacific time).\r\n   * @example \"2021-01-01T00:00:00.000000+00:00\" -> \"Dec 31, 2020 at 04:00 pm Pacific time\" (PST example)\r\n   * @example \"2021-07-01T00:00:00.000000+00:00\" -> \"Jun 30, 2021 at 05:00 pm Pacific time\" (PDT example)\r\n   */\r\n  apiToPacificDateTime (dateTimeString: ApiDateTimeUtc): string {\r\n    if (!dateTimeString) return null // safety check\r\n\r\n    const date = this.apiToDate(dateTimeString)\r\n    const dateStr = this.dateToPacificDate(date, true)\r\n    const timeStr = this.dateToPacificTime(date)\r\n\r\n    return `${dateStr} at ${timeStr} Pacific time`\r\n  }\r\n\r\n  /**\r\n   * Add a number of months to a date and return \"YYYY-MM-DD\".\r\n   * Date must be in the format of \"YYYY-MM-DD\" and months is a number\r\n   * @example (3, 2023-02-03) -> \"2023-05-03\"\r\n   * @example (18, 2023-02-03) -> \"2024-08-03\"\r\n   */\r\n  addMonthsToDate (month: number, date: string): string {\r\n    if (!date) {\r\n      date = '2023-01-01'\r\n    }\r\n    const temp = this.yyyyMmDdToDate(date)\r\n    temp.setMonth(temp.getMonth() + month)\r\n    const dateAfterAddition = this.dateToYyyyMmDd(temp)\r\n    return dateAfterAddition\r\n  }\r\n\r\n  /**\r\n   * Decrease one date from another and return number of months as the difference.\r\n   * Dates must be in the \"YYYY-MM-DD\" format\r\n   * @example (2023-02-03, 2024-08-03) -> 18\r\n   * @example (2023-02-03, 2023-04-03) -> 2\r\n   */\r\n  subtractDates (dateFrom: string, dateTo: string): number {\r\n    if (!dateFrom) {\r\n      dateFrom = '2023-01-01'\r\n    }\r\n    if (!dateTo) {\r\n      dateTo = this.addMonthsToDate(24, dateFrom)\r\n    }\r\n    const expiryDate = this.yyyyMmDdToDate(dateTo)\r\n    const currDate = this.yyyyMmDdToDate(dateFrom)\r\n    const monthDiff = expiryDate.getMonth() - currDate.getMonth()\r\n    const yearDiff = (12 * (expiryDate.getFullYear() - currDate.getFullYear()))\r\n    let difference = monthDiff + yearDiff\r\n    // For example if Jan 31st and March 1, difference is 1 not 2\r\n    if (expiryDate.getDate() < currDate.getDate()) {\r\n      difference--\r\n    }\r\n    return difference\r\n  }\r\n}\r\n","import Vue from 'vue'\r\nimport { Component } from 'vue-property-decorator'\r\nimport { NameRequestStates, NrRequestActionCodes } from '@bcrs-shared-components/enums'\r\nimport { NameRequestIF } from '@bcrs-shared-components/interfaces'\r\n\r\n/**\r\n * Mixin that provides some useful Name Request utilities.\r\n */\r\n@Component({})\r\nexport default class NameRequestMixin extends Vue {\r\n  /**\r\n   * Validates a name request against the applicant's information.\r\n   * Throws an error if there is a problem.\r\n   * @param nameRequest the name request object\r\n   * @param nrRequestActionCode the request action code to match\r\n   * @param businessId the business identifier to match\r\n   * @param phone the applicant's phone number to match\r\n   * @param email the applicant's email address to match\r\n   * @returns the name request object\r\n   */\r\n  validateNameRequest (\r\n    nameRequest: NameRequestIF,\r\n    nrRequestActionCode: NrRequestActionCodes,\r\n    businessId?: string,\r\n    phone?: string,\r\n    email?: string\r\n  ): NameRequestIF {\r\n    // ensure NR is valid\r\n    const invalid = this.isNrInvalid(nameRequest)\r\n    if (invalid) {\r\n      throw new Error(`Invalid Name Request: ${invalid}`)\r\n    }\r\n\r\n    if (nameRequest.request_action_cd !== nrRequestActionCode) {\r\n      throw new Error('Incorrect Request Action Code')\r\n    }\r\n\r\n    // match business id\r\n    if (businessId && nameRequest.corpNum !== businessId) {\r\n      throw new Error('Incorrect Business ID')\r\n    }\r\n\r\n    // match email\r\n    if (email && nameRequest.applicants?.emailAddress !== email) {\r\n      throw new Error('Incorrect Email Address')\r\n    }\r\n\r\n    // match phone\r\n    if (phone && nameRequest.applicants?.phoneNumber !== phone) {\r\n      throw new Error('Incorrect Phone Number')\r\n    }\r\n\r\n    // ensure NR is consumable\r\n    const state = this.getNrState(nameRequest)\r\n    if (state !== NameRequestStates.APPROVED && state !== NameRequestStates.CONDITIONAL) {\r\n      throw new Error(`Invalid Name Request state: ${state}`)\r\n    }\r\n\r\n    return nameRequest\r\n  }\r\n\r\n  /**\r\n   * Returns error message if the Name Request data is invalid (or null if valid).\r\n   * @param nameRequest the name request object\r\n   * @param requestActionCode the request action code to match\r\n   */\r\n  isNrInvalid (nameRequest: NameRequestIF): string {\r\n    if (!nameRequest) return 'Invalid NR object'\r\n    if (!nameRequest.applicants) return 'Invalid NR applicants'\r\n    if (!nameRequest.expirationDate) return 'Invalid NR expiration date\\n(NR may still be processing)'\r\n    if (!nameRequest.legalType) return 'Invalid NR legal type'\r\n    if (!this.getNrApprovedName(nameRequest)) return 'Invalid NR approved name'\r\n    if (!nameRequest.nrNum) return 'Invalid NR number'\r\n    if (!nameRequest.requestTypeCd) return 'Invalid NR request type code'\r\n    if (!nameRequest.request_action_cd) return 'Invalid NR request action code'\r\n    if (!nameRequest.state) return 'Invalid NR state'\r\n    return null\r\n  }\r\n\r\n  /**\r\n   * Returns the Name Request's state.\r\n   * @param nameRequest the name request object\r\n   */\r\n  getNrState (nameRequest: NameRequestIF): NameRequestStates {\r\n    // ensure a NR object is provided\r\n    if (!nameRequest) return null\r\n\r\n    // if the NR is awaiting consent, it is not consumable\r\n    // null = consent not required\r\n    // R = consent received\r\n    // N = consent waived\r\n    // Y = consent required\r\n    if (nameRequest.state === NameRequestStates.CONDITIONAL &&\r\n      nameRequest.consentFlag !== null && nameRequest.consentFlag !== 'R' && nameRequest.consentFlag !== 'N') {\r\n      return NameRequestStates.NEED_CONSENT\r\n    }\r\n\r\n    // if the NR's root state is not APPROVED or CONDITIONAL, it is not consumable\r\n    // NB: EXPIRED or CONSUMED should not return NOT_APPROVED\r\n    if (![NameRequestStates.APPROVED, NameRequestStates.CONDITIONAL,\r\n      NameRequestStates.EXPIRED, NameRequestStates.CONSUMED].includes(nameRequest.state)) {\r\n      return NameRequestStates.NOT_APPROVED\r\n    }\r\n\r\n    // otherwise, the NR is consumable\r\n    return nameRequest.state // APPROVED or CONDITIONAL or CONSUMED or EXPIRED\r\n  }\r\n\r\n  /**\r\n   * Returns the Name Request's approved name (or undefined or null if not found).\r\n   * @param nameRequest the name request object\r\n   */\r\n  getNrApprovedName (nameRequest: NameRequestIF): string {\r\n    if (nameRequest?.names?.length > 0) {\r\n      return nameRequest.names\r\n        .find(name => [NameRequestStates.APPROVED, NameRequestStates.CONDITION].includes(name.state))?.name\r\n    }\r\n    return null // invalid NR or names array\r\n  }\r\n\r\n  /**\r\n   * Maps the request action code to a display description.\r\n   * @param requestActionCode the request action code\r\n   */\r\n  getNrRequestDesc (requestActionCode: NrRequestActionCodes): string {\r\n    switch (requestActionCode) {\r\n      case NrRequestActionCodes.NEW_BUSINESS: return 'New Business'\r\n      case NrRequestActionCodes.CHANGE_NAME: return 'Change of Name'\r\n      case NrRequestActionCodes.CONVERSION: return 'Conversion'\r\n      case NrRequestActionCodes.RESTORE: return 'Restoration'\r\n    }\r\n    return null // should never happen\r\n  }\r\n}\r\n","import { Component, Vue } from 'vue-property-decorator'\r\n\r\nimport countries from 'country-list/data.json'\r\nimport provinces from 'provinces/provinces.json'\r\n\r\n// import these and sort them only once globally\r\nwindow['countries'] = window['countries'] || countries\r\n  .sort((a, b) => (a.name < b.name) ? -1 : (a.name > b.name) ? 1 : 0)\r\n\r\nwindow['provinces'] = window['provinces'] || provinces\r\n  .sort((a, b) => (a.name < b.name) ? -1 : (a.name > b.name) ? 1 : 0)\r\n\r\n// global caching to improve performance when called multiple times\r\nwindow['countryNameCache'] = {}\r\nwindow['countryRegionsCache'] = {}\r\n\r\n/**\r\n * Mixin that allows VM access to useful country/province data and functions.\r\n * @link https://www.npmjs.com/package/country-list\r\n * @lint https://www.npmjs.com/package/provinces\r\n */\r\n@Component({})\r\nexport default class CountriesProvincesMixin extends Vue {\r\n  /**\r\n   * Helper function to return a list of countries.\r\n   * @returns An array of country objects, sorted alphabetically.\r\n   */\r\n  getCountries (): Array<object> {\r\n    return window['countries']\r\n  }\r\n\r\n  /**\r\n   * Helper function to return a country's name.\r\n   * @param code The short code of the country.\r\n   * @returns The long name of the country.\r\n   */\r\n  getCountryName (code: string): string {\r\n    if (!code) return null\r\n    if (window['countryNameCache'][code]) return window['countryNameCache'][code]\r\n    const country = window['countries'].find(c => c.code === code)\r\n    const result = country ? country.name : null\r\n    window['countryNameCache'][code] = result\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * Helper function to return a country's list of provinces.\r\n   * @param code The short code of the country.\r\n   * @returns An array of province objects, sorted alphabetically.\r\n   */\r\n  getCountryRegions (code: string): Array<object> {\r\n    if (!code) return null\r\n    if (window['countryRegionsCache'][code]) return window['countryRegionsCache'][code]\r\n    const result = window['provinces']\r\n      .filter(p => p.country === code)\r\n      .map(p => ({\r\n        name: p.english || p.name,\r\n        short: (p.short && p.short.length <= 2) ? p.short : '--'\r\n      }))\r\n    window['countryRegionsCache'][code] = result\r\n    return result\r\n  }\r\n}\r\n","import { Component, Vue } from 'vue-property-decorator'\r\n\r\n/**\r\n * Mixin that provides some useful validation utilities.\r\n */\r\n@Component({})\r\nexport default class ValidationMixin extends Vue {\r\n  /**\r\n   * Creates a Vuetify rules object from the Vuelidate state.\r\n   * @param model The name of the model we are validating.\r\n   * @returns A Vuetify rules object.\r\n   */\r\n  public createVuetifyRulesObject (model: string): { [attr: string]: Array<any> } {\r\n    const obj = {\r\n      streetAddress: [],\r\n      streetAddressAdditional: [],\r\n      addressCity: [],\r\n      addressRegion: [],\r\n      postalCode: [],\r\n      addressCountry: [],\r\n      deliveryInstructions: []\r\n    }\r\n\r\n    // ensure Vuelidate state object is initialized\r\n    if (this.$v && this.$v[model]) {\r\n      // iterate over Vuelidate object properties\r\n      Object.keys(this.$v[model])\r\n        // only look at validation properties\r\n        .filter(prop => prop.charAt(0) !== '$')\r\n        .forEach(prop => {\r\n          // create array for each validation property\r\n          obj[prop] = []\r\n          // iterate over validation property params\r\n          Object.keys(this.$v[model][prop].$params)\r\n            .forEach(param => {\r\n              // add specified validation functions to array\r\n              switch (param) {\r\n                case 'required': obj[prop].push(() => this.requiredRule(model, prop)); break\r\n                case 'minLength': obj[prop].push(() => this.minLengthRule(model, prop)); break\r\n                case 'maxLength': obj[prop].push(() => this.maxLengthRule(model, prop)); break\r\n                case 'isCanada': obj[prop].push(() => this.isCanadaRule(model, prop)); break\r\n                case 'isBC': obj[prop].push(() => this.isBCRule(model, prop)); break\r\n                // FUTURE: add extra validation functions here\r\n                default: break\r\n              }\r\n            })\r\n        })\r\n    }\r\n\r\n    // sample return object\r\n    // streetAddress: [\r\n    //   () => this.requiredRule('addressLocal', 'streetAddress'),\r\n    //   () => this.minLengthRule('addressLocal', 'streetAddress'),\r\n    //   () => this.maxLengthRule('addressLocal', 'streetAddress')\r\n    // ],\r\n    // ...\r\n\r\n    return obj\r\n  }\r\n\r\n  /**\r\n   * Misc Vuetify rules.\r\n   * @param prop The name of the property object to validate.\r\n   * @param key The name of the property key (field) to validate.\r\n   * @returns True if the rule passes, otherwise an error string.\r\n   */\r\n  protected requiredRule (prop: string, key: string): boolean | string {\r\n    return Boolean(this.$v[prop] && this.$v[prop][key].required) || 'This field is required'\r\n  }\r\n\r\n  protected minLengthRule (prop: string, key: string): boolean | string {\r\n    const min = this.$v[prop][key].$params.minLength.min\r\n    return Boolean(this.$v[prop] && this.$v[prop][key].minLength) || `Minimum length is ${min}`\r\n  }\r\n\r\n  protected maxLengthRule (prop: string, key: string): boolean | string {\r\n    const max = this.$v[prop][key].$params.maxLength.max\r\n    return Boolean(this.$v[prop] && this.$v[prop][key].maxLength) || `Maximum length is ${max}`\r\n  }\r\n\r\n  // FUTURE: generalize this rule to take a validation parameter (ie, 'CA')\r\n  protected isCanadaRule (prop: string, key: string): boolean | string {\r\n    return Boolean(this.$v[prop] && this.$v[prop][key].isCanada) || `Address must be in Canada`\r\n  }\r\n\r\n  // FUTURE: generalize this rule to take a validation parameter (ie, 'BC')\r\n  protected isBCRule (prop: string, key: string): boolean | string {\r\n    return Boolean(this.$v[prop] && this.$v[prop][key].isBC) || `Address must be in BC`\r\n  }\r\n}\r\n"],"names":["NrRequestActionCodes","NameRequestStates","DateMixin","Vue","year","month","day","hours","minutes","date","utcDate","tzDate","offset","dateTimeString","dateStr","split","isDate","mm","dd","yyyy","longMonth","showWeekday","timeStr","temp","dateFrom","dateTo","expiryDate","currDate","monthDiff","yearDiff","difference","__decorateClass","Component","NameRequestMixin","nameRequest","nrRequestActionCode","businessId","phone","email","invalid","_a","_b","state","name","requestActionCode","countries","a","b","provinces","CountriesProvincesMixin","code","country","c","result","p","ValidationMixin","model","obj","prop","param","key","min","max"],"mappings":"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"}