var j=Object.defineProperty;var W=(t,e,r)=>e in t?j(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var n=(t,e,r)=>(W(t,typeof e!="symbol"?e+"":e,r),r);import{V as N}from"./vue.esm-b1e57a2f.js";import{C as h,P as l,E as L}from"./Prop-817ec8de.js";import{W as K}from"./Watch-c62128e4.js";import{A}from"./index-2b7fa976.js";import{S as p}from"./sbc-common-components-constants-18bc9b73.js";import{n as b}from"./_plugin-vue2_normalizer-2bbd088e.js";import{C as z}from"./corp-type-module-5c1df937.js";import"./_commonjsHelpers-de833af9.js";var D=(t=>(t[t.BACK=0]="BACK",t[t.CANCEL=1]="CANCEL",t[t.CONFIRM=2]="CONFIRM",t[t.SAVE_RESUME_LATER=3]="SAVE_RESUME_LATER",t))(D||{}),U=(t=>(t.ADDRESS_CHANGE_BC="BCADD",t.ADDRESS_CHANGE_OT="OTADD",t.AGM_EXTENSION="AGMDT",t.AGM_LOCATION_CHANGE="AGMLC",t.AFFIDAVIT="AFDVT",t.ALTERATION="ALTER",t.ALTERATION_BC_TO_ULC="NOALU",t.AMALGAMATION_HORIZONTAL="AMALH",t.AMALGAMATION_REGULAR="AMALR",t.AMALGAMATION_VERTICAL="AMALV",t.AMALGAMATION_OUT="AMALO",t.ANNUAL_REPORT_BC="BCANN",t.ANNUAL_REPORT_OT="OTANN",t.CHANGE_OF_REGISTRATION="FMCHANGE",t.CONSENT_AMALGAMATION_OUT="IAMGO",t.CONSENT_CONTINUATION_OUT="CONTO",t.CONTINUATION_IN="CONTI",t.CONTINUATION_OUT="COUTI",t.CORRECTION="CRCTN",t.DIRECTOR_CHANGE_BC="BCCDR",t.DIRECTOR_CHANGE_OT="OTCDR",t.DISSOLUTION_ADMINISTRATIVE="DIS_ADMIN",t.DISSOLUTION_COURT_ORDERED_LIQUIDATION="DIS_COLQD",t.DISSOLUTION_INVOLUNTARY="DIS_INVOL",t.DISSOLUTION_RESTORED_IN_ERROR="DIS_RSTR",t.DISSOLUTION_VOLUNTARY="DIS_VOL",t.DISSOLUTION_VOLUNTARY_LIQUIDATION="DIS_LQD",t.FM_CHANGE="FMCHANGE",t.FM_CONVERSION="FMCONV",t.FM_CORRECTION="FMCORR",t.FREE_DIRECTOR_CHANGE_BC="BCFDR",t.FREE_DIRECTOR_CHANGE_OT="OTFDR",t.INCORPORATION_BC="BCINC",t.INCORPORATION_BEN="BCINC",t.INCORPORATION_CC="BCINC",t.INCORPORATION_CP="OTINC",t.INCORPORATION_ULC="BCINC",t.NOTICE_OF_WITHDRAWAL="NWITH",t.REGISTRATION_GP="FRREG",t.REGISTRATION_SP="FRREG",t.RESTORATION_FULL="RESTF",t.RESTORATION_LIMITED="RESTL",t.RESTORATION_LTD_EXTEND="RESXL",t.RESTORATION_LTD_TO_FULL="RESXF",t.SPECIAL_RESOLUTION="SPRLN",t.SPECIAL_RESOLUTION_NAME_CHANGE="OTCON",t))(U||{});function _(t){return t?t.trim().replace(/\/+$/,""):""}class T{static addToSession(e,r){sessionStorage.setItem(e,r)}static getFromSession(e){return sessionStorage.getItem(e)}static removeFromSession(e){sessionStorage.removeItem(e)}static clearSession(){sessionStorage.clear()}static getStatusAPIUrl(){return _(sessionStorage.getItem(p.StatusApiUrl)||"")}static getAuthAPIUrl(){return _(sessionStorage.getItem(p.AuthApiUrl)||"")}static getAuthContextPath(){return _(sessionStorage.getItem(p.AuthWebUrl)||"")}static getRegistryHomeURL(){return _(sessionStorage.getItem(p.RegistryHomeUrl)||"")}static getNameRequestURL(){return _(sessionStorage.getItem(p.NameRequestUrl)||"")}static getPprWebURL(){return _(sessionStorage.getItem(p.PprWebUrl)||"")}static setKeycloakConfigUrl(e){this.keycloakConfigUrl=e}static getKeycloakConfigUrl(){return this.keycloakConfigUrl}}n(T,"keycloakConfigUrl","");const R={getFee(t,e){const r=T.getFromSession(p.KeyCloakToken),s=JSON.parse(T.getFromSession(p.CurrentAccount)||"{}").id||0;t.length<1&&Promise.resolve();const a=[];for(const i of t){i.filingTypeCode||Promise.resolve();const o=q(i,e);a.push(A.get(o,{headers:{Authorization:`Bearer ${r}`,"Account-Id":s}}))}return A.all(a).then(A.spread((...i)=>i.map(o=>o.data).map(o=>{const O=t.find(H=>H.filingTypeCode===o.filingTypeCode),x=O&&O.filingDescription?O.filingDescription:o.filingType,G=o.filingFees,$=o.priorityFees||0,V=o.futureEffectiveFees||0,B=o.serviceFees||0,k=o.total||0;return{fee:G,filingType:x,priorityFees:$,futureEffectiveFees:V,serviceFees:B,total:k}}))).catch(i=>{switch(i.response&&i.response.status){case 400:console.log("%c FeeModule-ERROR: Probably fee code mismatch %s","color: red; font-size: 13px",JSON.stringify(t));break;case 500:console.log("%c FeeModule-ERROR: Probably invalid Token %s","color: red; font-size: 13px",JSON.stringify(t));break;default:console.log("%c FeeModule-ERROR: Probably unknown Error %s","color: red; font-size: 13px",JSON.stringify(t))}return[]})}},q=(t,e)=>{const r=[];t.waiveFees&&r.push(`waiveFees=${!!t.waiveFees}`),t.priority&&r.push(`priority=${!!t.priority}`),t.futureEffective&&r.push(`futureEffective=${!!t.futureEffective}`);let s=`${e}fees/${t.entityType}/${t.filingTypeCode}`;return r.length&&(s+=`?${r.join("&")}`),s};var J=Object.defineProperty,Q=Object.getOwnPropertyDescriptor,u=(t,e,r,s)=>{for(var a=s>1?void 0:s?Q(e,r):e,i=t.length-1,o;i>=0;i--)(o=t[i])&&(a=(s?o(e,r,a):o(a))||a);return s&&a&&J(e,r,a),a};let m=class extends N{constructor(){super(...arguments);n(this,"filingData");n(this,"payURL");n(this,"filingLabel");n(this,"fees",[]);n(this,"fetchError","")}mounted(){R.getFee(this.filingData,this.payURL).then(r=>{this.fetchError="",this.fees=r||[],this.fees=this.fees.filter(s=>this.totalFilingFees>0&&s.fee||this.totalFilingFees===0),this.emitTotalFee(this.totalFilingFees)}).catch(r=>{this.fetchError="Error fetching fees"+r})}get totalFilingFees(){return this.fees.reduce((r,s)=>r+s.total,0)}onFilingDataChanged(r,s){R.getFee(this.filingData,this.payURL).then(a=>{this.fetchError="",this.fees=a,this.emitTotalFee(this.totalFilingFees)}).catch(a=>{this.fetchError="Error fetching fees"+a})}emitTotalFee(r){}};u([l({default:()=>[]})],m.prototype,"filingData",2);u([l({default:""})],m.prototype,"payURL",2);u([l()],m.prototype,"filingLabel",2);u([K("filingData")],m.prototype,"onFilingDataChanged",1);u([L("total-fee")],m.prototype,"emitTotalFee",1);m=u([h({})],m);var X=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("v-card",[r("header",{staticClass:"font-weight-bold px-3 py-3"},[e._t("header",function(){return[e._v(" Fee Summary ")]})],2),r("div",{directives:[{name:"show",rawName:"v-show",value:e.fetchError,expression:"fetchError"}]},[r("v-alert",{attrs:{color:"error",icon:"warning",outlined:""}},[e._v(" "+e._s(e.fetchError)+" ")])],1),r("v-slide-y-transition",{directives:[{name:"show",rawName:"v-show",value:!e.fetchError,expression:"!fetchError"}],staticClass:"fee-list",attrs:{group:"",tag:"ul"}},e._l(e.fees,function(s){return r("div",{key:s.filingType},[r("li",{staticClass:"container fee-list__item"},[r("div",{staticClass:"fee-list__item-name"},[e._v(" "+e._s(e.filingLabel?e.filingLabel:s.filingType)+" ")]),s.fee>0?r("div",{staticClass:"fee-list__item-value"},[e._v(" "+e._s(e._f("currency")(s.fee))+" ")]):r("div",{staticClass:"fee-list__item-value"},[e._v(" No Fee ")])]),s.priorityFees?r("li",{key:s.filingType+"-priority",staticClass:"container fee-list__item"},[r("div",{staticClass:"fee-list__item-name pl-3"},[e._v(" Priority Fee ")]),r("div",{staticClass:"fee-list__item-value"},[e._v(" "+e._s(e._f("currency")(s.priorityFees))+" ")])]):e._e(),s.futureEffectiveFees?r("li",{key:s.filingType+"-futureEffective",staticClass:"container fee-list__item"},[r("div",{staticClass:"fee-list__item-name pl-3"},[e._v(" Future Effective Fee ")]),r("div",{staticClass:"fee-list__item-value"},[e._v(" "+e._s(e._f("currency")(s.futureEffectiveFees))+" ")])]):e._e(),s.serviceFees?r("li",{key:s.filingType+"-transaction",staticClass:"container fee-list__item"},[r("div",{staticClass:"fee-list__item-name pl-3"},[e._v(" Service Fee ")]),r("div",{staticClass:"fee-list__item-value"},[e._v(" "+e._s(e._f("currency")(s.serviceFees))+" ")])]):e._e()])}),0),r("div",{directives:[{name:"show",rawName:"v-show",value:!e.fetchError,expression:"!fetchError"}],staticClass:"container fee-total"},[r("div",{staticClass:"fee-total__name"},[e._v(" Total Fees ")]),r("div",{staticClass:"fee-total__currency"},[e._v(" CAD ")]),r("div",{staticClass:"fee-total__value"},[r("v-slide-y-reverse-transition",{attrs:{name:"slide",mode:"out-in"}},[r("div",[e._v(" "+e._s(e._f("currency")(e.totalFilingFees))+" ")])])],1)])],1)},Y=[],F=b(m,X,Y,!1,null,"b1bb1460",null,null);const Z=F.exports;F.exports.__docgenInfo={exportName:"default",displayName:"SbcFeeSummary",description:"",tags:{},props:[{name:"filingData",tags:{},type:{name:"Array",elements:[{name:"FilingData"}]},defaultValue:{func:!0,value:"() => []"}},{name:"payURL",tags:{},type:{name:"string"},defaultValue:{func:!1,value:"''"}},{name:"filingLabel",tags:{},type:{name:"string"}}],events:[{name:"total-fee"}],slots:[{name:"header"}],sourceFiles:["/Users/cameron.bowler/_Never Backup/bcrs-shared-components/src/components/fee-summary/SbcFeeSummary.vue"]};var ee=Object.defineProperty,te=Object.getOwnPropertyDescriptor,f=(t,e,r,s)=>{for(var a=s>1?void 0:s?te(e,r):e,i=t.length-1,o;i>=0;i--)(o=t[i])&&(a=(s?o(e,r,a):o(a))||a);return s&&a&&ee(e,r,a),a};let c=class extends N{constructor(){super(...arguments);n(this,"FeeSummaryActions",D);n(this,"filingData");n(this,"payApiUrl");n(this,"hasConflicts");n(this,"isLoading");n(this,"confirmLabel");n(this,"errorMessage");n(this,"isSummaryMode")}emitAction(r){}};f([l({default:()=>[]})],c.prototype,"filingData",2);f([l({default:""})],c.prototype,"payApiUrl",2);f([l({default:!1})],c.prototype,"hasConflicts",2);f([l({default:!1})],c.prototype,"isLoading",2);f([l({default:"Confirm"})],c.prototype,"confirmLabel",2);f([l({default:""})],c.prototype,"errorMessage",2);f([l({default:!1})],c.prototype,"isSummaryMode",2);f([L("action")],c.prototype,"emitAction",1);c=f([h({components:{SbcFeeSummary:Z}})],c);var re=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("aside",{attrs:{id:"fee-summary"}},[r("sbc-fee-summary",{attrs:{filingData:[...e.filingData],payURL:e.payApiUrl}}),r("v-row",{attrs:{"no-gutters":""}},[e.isSummaryMode?r("v-col",{staticClass:"pt-3 pr-3"},[r("v-btn",{attrs:{id:"back-btn",large:"",loading:e.isLoading},on:{click:function(s){return e.emitAction(e.FeeSummaryActions.BACK)}}},[r("span",[r("v-icon",[e._v("mdi-chevron-left")]),e._v("Back")],1)])],1):e._e(),r("v-col",{staticClass:"pt-3"},[r("v-btn",{attrs:{id:"cancel-btn",large:"",loading:e.isLoading},on:{click:function(s){return e.emitAction(e.FeeSummaryActions.CANCEL)}}},[r("span",[e._v("Cancel")])])],1),r("v-col",{staticClass:"pt-3"},[r("v-btn",{attrs:{id:"save-resume-later-btn",large:"",loading:e.isLoading},on:{click:function(s){return e.emitAction(e.FeeSummaryActions.SAVE_RESUME_LATER)}}},[r("span",[e._v("Save and Resume Later")])])],1),r("v-col",{staticClass:"pt-3"},[r("v-btn",{attrs:{id:"confirm-btn",large:"",disabled:e.hasConflicts,loading:e.isLoading},on:{click:function(s){return e.emitAction(e.FeeSummaryActions.CONFIRM)}}},[r("span",[e._v(e._s(e.confirmLabel)),r("v-icon",[e._v("mdi-chevron-right")])],1)])],1)],1),e.errorMessage?r("div",{staticClass:"error-msg pre-wrap mt-1",domProps:{innerHTML:e._s(e.errorMessage)}}):e._e()],1)},se=[],M=b(c,re,se,!1,null,"f5b2597d",null,null);const ae=M.exports;M.exports.__docgenInfo={exportName:"default",displayName:"FeeSummary",description:"",tags:{},props:[{name:"filingData",tags:{},description:"Filing information to calculate fees.",type:{name:"Array",elements:[{name:"FilingDataIF"}]},defaultValue:{func:!0,value:"() => []"}},{name:"payApiUrl",tags:{},description:"URL for Sbc Fee Summary component to get fees.",type:{name:"string"},defaultValue:{func:!1,value:"''"}},{name:"hasConflicts",tags:{},description:"Indicator that something isn't valid.",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"isLoading",tags:{},description:"Indicator that there is a request in progress.",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"confirmLabel",tags:{},description:"Label for Confirm button.",type:{name:"string"},defaultValue:{func:!1,value:"'Confirm'"}},{name:"errorMessage",tags:{},description:"Message to display if there is an error.",type:{name:"string"},defaultValue:{func:!1,value:"''"}},{name:"isSummaryMode",tags:{},description:"Prop to indicate summary mode.",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}}],events:[{name:"action",description:"Emit action event."}],sourceFiles:["/Users/cameron.bowler/_Never Backup/bcrs-shared-components/src/components/fee-summary/FeeSummary.vue"]};N.filter("currency",t=>`$${t}`);const ye={title:"component/FeeSummary"},P=(t,{argTypes:e})=>({props:Object.keys(e),components:{FeeSummary:ae},template:'<div style="max-width: 350px"><fee-summary v-bind="$props" /></div>'}),w=[{filingTypeCode:U.ALTERATION,entityType:z.CORPORATION,priority:!1}],v=P.bind({});v.args={filingData:w,payApiUrl:"https://pay-api-dev.apps.silver.devops.gov.bc.ca/api/v1/",hasConflicts:!1,isLoading:!1,confirmLabel:"Continue",errorMessage:""};const y=P.bind({});y.args={filingData:w,payApiUrl:"https://pay-api-dev.apps.silver.devops.gov.bc.ca/api/v1/",hasConflicts:!1,isLoading:!1,confirmLabel:"File and Pay",errorMessage:"",isSummaryMode:!0};var d,g,E;v.parameters={...v.parameters,docs:{...(d=v.parameters)==null?void 0:d.docs,source:{originalSource:`(args, {
  argTypes
}) => ({
  props: Object.keys(argTypes),
  components: {
    FeeSummary
  },
  template: '<div style="max-width: 350px"><fee-summary v-bind="$props" /></div>' // $props comes from args below
})`,...(E=(g=v.parameters)==null?void 0:g.docs)==null?void 0:E.source}}};var S,I,C;y.parameters={...y.parameters,docs:{...(S=y.parameters)==null?void 0:S.docs,source:{originalSource:`(args, {
  argTypes
}) => ({
  props: Object.keys(argTypes),
  components: {
    FeeSummary
  },
  template: '<div style="max-width: 350px"><fee-summary v-bind="$props" /></div>' // $props comes from args below
})`,...(C=(I=y.parameters)==null?void 0:I.docs)==null?void 0:C.source}}};const Oe=["Default","summaryMode"];export{v as Default,Oe as __namedExportsOrder,ye as default,y as summaryMode};
//# sourceMappingURL=FeeSummary.stories-3d86595c.js.map
