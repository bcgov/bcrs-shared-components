var j=Object.defineProperty;var K=(e,t,a)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var n=(e,t,a)=>(K(e,typeof t!="symbol"?t+"":t,a),a);import{V as N}from"./vue.esm-b1e57a2f.js";import{C as g,P as l,E as U,n as D}from"./_plugin-vue2_normalizer-b11a0120.js";import{W as b}from"./Watch-62f8b699.js";import{a as R}from"./index-28508b38.js";import{S as _}from"./sbc-common-components-constants-ecf195d0.js";import{C as z}from"./corp-type-module-5c1df937.js";import"./_commonjsHelpers-de833af9.js";var p=(e=>(e[e.BACK=0]="BACK",e[e.CANCEL=1]="CANCEL",e[e.CONFIRM=2]="CONFIRM",e[e.SAVE_RESUME_LATER=3]="SAVE_RESUME_LATER",e))(p||{}),M=(e=>(e.ADDRESS_CHANGE_BC="BCADD",e.ADDRESS_CHANGE_OT="OTADD",e.ADDRESS_CHANGE_LIQUIDATOR="NOCAL",e.ADDRESS_CHANGE_RECEIVER="NOCRM",e.AGM_EXTENSION="AGMDT",e.AGM_LOCATION_CHANGE="AGMLC",e.AFFIDAVIT="AFDVT",e.ALTERATION="ALTER",e.ALTERATION_BC_TO_ULC="NOALU",e.AMALGAMATION_HORIZONTAL="AMALH",e.AMALGAMATION_REGULAR="AMALR",e.AMALGAMATION_VERTICAL="AMALV",e.AMALGAMATION_OUT="AMALO",e.AMEND_RECEIVER="AMEND",e.ANNUAL_REPORT_BC="BCANN",e.ANNUAL_REPORT_OT="OTANN",e.APPOINT_LIQUIDATOR="NOAPL",e.APPOINT_RECEIVER="NOARM",e.CEASE_LIQUIDATOR="NOCEL",e.CEASE_RECEIVER="NOCER",e.CHANGE_OF_REGISTRATION="FMCHANGE",e.CONSENT_AMALGAMATION_OUT="IAMGO",e.CONSENT_CONTINUATION_OUT="CONTO",e.CONTINUATION_IN="CONTI",e.CONTINUATION_OUT="COUTI",e.CORRECTION="CRCTN",e.COURT_ORDER="COURT",e.DIRECTOR_CHANGE_BC="BCCDR",e.DIRECTOR_CHANGE_OT="OTCDR",e.DISSOLUTION_ADMINISTRATIVE="DIS_ADMIN",e.DISSOLUTION_COURT_ORDERED_LIQUIDATION="DIS_COLQD",e.DISSOLUTION_INVOLUNTARY="DIS_INVOL",e.DISSOLUTION_RESTORED_IN_ERROR="DIS_RSTR",e.DISSOLUTION_VOLUNTARY="DIS_VOL",e.DISSOLUTION_VOLUNTARY_LIQUIDATION="DIS_LQD",e.FM_CHANGE="FMCHANGE",e.FM_CONVERSION="FMCONV",e.FM_CORRECTION="FMCORR",e.FREE_DIRECTOR_CHANGE_BC="BCFDR",e.FREE_DIRECTOR_CHANGE_OT="OTFDR",e.INCORPORATION_BC="BCINC",e.INCORPORATION_BEN="BCINC",e.INCORPORATION_CC="BCINC",e.INCORPORATION_CP="OTINC",e.INCORPORATION_ULC="BCINC",e.INTENT_TO_LIQUIDATE="LQSIN",e.LIQUIDATION_REPORT="LIQUR",e.NOTICE_OF_WITHDRAWAL="NWITH",e.REGISTRATION_GP="FRREG",e.REGISTRATION_SP="FRREG",e.RESTORATION_FULL="RESTF",e.RESTORATION_LIMITED="RESTL",e.RESTORATION_LTD_EXTEND="RESXL",e.RESTORATION_LTD_TO_FULL="RESXF",e.SPECIAL_RESOLUTION="SPRLN",e.SPECIAL_RESOLUTION_NAME_CHANGE="OTCON",e))(M||{});function m(e){return e?e.trim().replace(/\/+$/,""):""}class v{static addToSession(t,a){sessionStorage.setItem(t,a)}static getFromSession(t){return sessionStorage.getItem(t)}static removeFromSession(t){sessionStorage.removeItem(t)}static clearSession(){sessionStorage.clear()}static getStatusAPIUrl(){return m(sessionStorage.getItem(_.StatusApiUrl)||"")}static getAuthAPIUrl(){return m(sessionStorage.getItem(_.AuthApiUrl)||"")}static getAuthContextPath(){return m(sessionStorage.getItem(_.AuthWebUrl)||"")}static getRegistryHomeURL(){return m(sessionStorage.getItem(_.RegistryHomeUrl)||"")}static getNameRequestURL(){return m(sessionStorage.getItem(_.NameRequestUrl)||"")}static getPprWebURL(){return m(sessionStorage.getItem(_.PprWebUrl)||"")}static setKeycloakConfigUrl(t){this.keycloakConfigUrl=t}static getKeycloakConfigUrl(){return this.keycloakConfigUrl}}n(v,"keycloakConfigUrl","");const S={getFee(e,t){const a=v.getFromSession(_.KeyCloakToken),r=JSON.parse(v.getFromSession(_.CurrentAccount)||"{}").id||0;e.length<1&&Promise.resolve();const s=[];for(const i of e){i.filingTypeCode||Promise.resolve();const o=J(i,t);s.push(R.get(o,{headers:{Authorization:`Bearer ${a}`,"Account-Id":r}}))}return R.all(s).then(R.spread((...i)=>i.map(o=>o.data).map(o=>{const T=e.find(Y=>Y.filingTypeCode===o.filingTypeCode),k=T&&T.filingDescription?T.filingDescription:o.filingType,$=o.filingFees,w=o.priorityFees||0,H=o.futureEffectiveFees||0,W=o.serviceFees||0,Q=o.total||0;return{fee:$,filingType:k,priorityFees:w,futureEffectiveFees:H,serviceFees:W,total:Q}}))).catch(i=>{switch(i.response&&i.response.status){case 400:console.log("%c FeeModule-ERROR: Probably fee code mismatch %s","color: red; font-size: 13px",JSON.stringify(e));break;case 500:console.log("%c FeeModule-ERROR: Probably invalid Token %s","color: red; font-size: 13px",JSON.stringify(e));break;default:console.log("%c FeeModule-ERROR: Probably unknown Error %s","color: red; font-size: 13px",JSON.stringify(e))}return[]})}},J=(e,t)=>{const a=[];e.waiveFees&&a.push(`waiveFees=${!!e.waiveFees}`),e.priority&&a.push(`priority=${!!e.priority}`),e.futureEffective&&a.push(`futureEffective=${!!e.futureEffective}`);let r=`${t}fees/${e.entityType}/${e.filingTypeCode}`;return a.length&&(r+=`?${a.join("&")}`),r};var F=(e=>(e.KeyCloakToken="KEYCLOAK_TOKEN",e.KeyCloakRefreshToken="KEYCLOAK_REFRESH_TOKEN",e.KeyCloakIdToken="KEYCLOAK_ID_TOKEN",e.ApiConfigKey="AUTH_API_CONFIG",e.PreventStorageSync="PREVENT_STORAGE_SYNC",e.LaunchDarklyFlags="LD_FLAGS",e.CurrentAccount="CURRENT_ACCOUNT",e.AuthApiUrl="AUTH_API_URL",e.AuthWebUrl="AUTH_WEB_URL",e.StatusApiUrl="STATUS_API_URL",e.WhatsNew="WHATS_NEW",e.SessionSynced="SESSION_SYNCED",e.RegistryHomeUrl="REGISTRY_HOME_URL",e.NameRequestUrl="NAME_REQUEST_URL",e.PprWebUrl="PPR_WEB_URL",e.SiteminderLogoutUrl="SITEMINDER_LOGOUT_URL",e))(F||{});const q=R.create();q.interceptors.request.use(e=>{var t;return e.headers["x-apikey"]={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1,STORYBOOK:"true"}.VUE_APP_DOC_API_KEY,e.headers["Account-Id"]=((t=JSON.parse(v.getFromSession(F.CurrentAccount)||"{}"))==null?void 0:t.id)||0,e},e=>Promise.reject(e));var X=Object.defineProperty,Z=Object.getOwnPropertyDescriptor,A=(e,t,a,r)=>{for(var s=r>1?void 0:r?Z(t,a):t,i=e.length-1,o;i>=0;i--)(o=e[i])&&(s=(r?o(t,a,s):o(s))||s);return r&&s&&X(t,a,s),s};let f=class extends N{constructor(){super(...arguments);n(this,"filingData");n(this,"payURL");n(this,"filingLabel");n(this,"fees",[]);n(this,"fetchError","")}mounted(){S.getFee(this.filingData,this.payURL).then(a=>{this.fetchError="",this.fees=a||[],this.fees=this.fees.filter(r=>this.totalFilingFees>0&&r.fee||this.totalFilingFees===0),this.emitTotalFee(this.totalFilingFees)}).catch(a=>{this.fetchError="Error fetching fees"+a})}get totalFilingFees(){return this.fees.reduce((a,r)=>a+r.total,0)}onFilingDataChanged(a,r){S.getFee(this.filingData,this.payURL).then(s=>{this.fetchError="",this.fees=s,this.emitTotalFee(this.totalFilingFees)}).catch(s=>{this.fetchError="Error fetching fees"+s})}emitTotalFee(a){}};A([l({default:()=>[]})],f.prototype,"filingData",2);A([l({default:""})],f.prototype,"payURL",2);A([l()],f.prototype,"filingLabel",2);A([b("filingData")],f.prototype,"onFilingDataChanged",1);A([U("total-fee")],f.prototype,"emitTotalFee",1);f=A([g({})],f);var ee=function(){var t=this,a=t._self._c;return t._self._setupProxy,a("v-card",[a("header",{staticClass:"font-weight-bold px-3 py-3"},[t._t("header",function(){return[t._v(" Fee Summary ")]})],2),a("div",{directives:[{name:"show",rawName:"v-show",value:t.fetchError,expression:"fetchError"}]},[a("v-alert",{attrs:{color:"error",icon:"warning",outlined:""}},[t._v(" "+t._s(t.fetchError)+" ")])],1),a("v-slide-y-transition",{directives:[{name:"show",rawName:"v-show",value:!t.fetchError,expression:"!fetchError"}],staticClass:"fee-list",attrs:{group:"",tag:"ul"}},t._l(t.fees,function(r){return a("div",{key:r.filingType},[a("li",{staticClass:"container fee-list__item"},[a("div",{staticClass:"fee-list__item-name"},[t._v(" "+t._s(t.filingLabel?t.filingLabel:r.filingType)+" ")]),r.fee>0?a("div",{staticClass:"fee-list__item-value"},[t._v(" "+t._s(t._f("currency")(r.fee))+" ")]):a("div",{staticClass:"fee-list__item-value"},[t._v(" No Fee ")])]),r.priorityFees?a("li",{key:r.filingType+"-priority",staticClass:"container fee-list__item"},[a("div",{staticClass:"fee-list__item-name pl-3"},[t._v(" Priority Fee ")]),a("div",{staticClass:"fee-list__item-value"},[t._v(" "+t._s(t._f("currency")(r.priorityFees))+" ")])]):t._e(),r.futureEffectiveFees?a("li",{key:r.filingType+"-futureEffective",staticClass:"container fee-list__item"},[a("div",{staticClass:"fee-list__item-name pl-3"},[t._v(" Future Effective Fee ")]),a("div",{staticClass:"fee-list__item-value"},[t._v(" "+t._s(t._f("currency")(r.futureEffectiveFees))+" ")])]):t._e(),r.serviceFees?a("li",{key:r.filingType+"-transaction",staticClass:"container fee-list__item"},[a("div",{staticClass:"fee-list__item-name pl-3"},[t._v(" Service Fee ")]),a("div",{staticClass:"fee-list__item-value"},[t._v(" "+t._s(t._f("currency")(r.serviceFees))+" ")])]):t._e()])}),0),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.fetchError,expression:"!fetchError"}],staticClass:"container fee-total"},[a("div",{staticClass:"fee-total__name"},[t._v(" Total Fees ")]),a("div",{staticClass:"fee-total__currency"},[t._v(" CAD ")]),a("div",{staticClass:"fee-total__value"},[a("v-slide-y-reverse-transition",{attrs:{name:"slide",mode:"out-in"}},[a("div",[t._v(" "+t._s(t._f("currency")(t.totalFilingFees))+" ")])])],1)])],1)},te=[],P=D(f,ee,te,!1,null,"ed56acdd",null,null);const ae=P.exports;P.exports.__docgenInfo={exportName:"default",displayName:"SbcFeeSummary",description:"",tags:{},props:[{name:"filingData",tags:{},type:{name:"Array",elements:[{name:"FilingData"}]},defaultValue:{func:!0,value:"() => []"}},{name:"payURL",tags:{},type:{name:"string"},defaultValue:{func:!1,value:"''"}},{name:"filingLabel",tags:{},type:{name:"string"}}],events:[{name:"total-fee"}],slots:[{name:"header"}],sourceFiles:["/home/severin/repos/bcrs-shared-components/src/components/fee-summary/SbcFeeSummary.vue"]};var re=Object.defineProperty,se=Object.getOwnPropertyDescriptor,u=(e,t,a,r)=>{for(var s=r>1?void 0:r?se(t,a):t,i=e.length-1,o;i>=0;i--)(o=e[i])&&(s=(r?o(t,a,s):o(s))||s);return r&&s&&re(t,a,s),s},B=(e=>(e.DEFAULT="",e.LOADING="loading",e.DISABLE="disable",e))(B||{});let c=class extends N{constructor(){super(...arguments);n(this,"FeeSummaryActions",p);n(this,"ButtonState",B);n(this,"filingData");n(this,"payApiUrl");n(this,"disableSaveResumeLater");n(this,"hasConflicts");n(this,"isLoading");n(this,"confirmLabel");n(this,"errorMessage");n(this,"isSummaryMode");n(this,"currentLoadingAction",null)}emitAction(a){}onIsLoadingChanged(a){a||(this.currentLoadingAction=null)}get baseButtonStatus(){return{[p.BACK]:"",[p.CANCEL]:"",[p.SAVE_RESUME_LATER]:this.disableSaveResumeLater?"disable":"",[p.CONFIRM]:this.hasConflicts?"disable":""}}get buttonStatus(){if(!this.isLoading||!this.currentLoadingAction)return this.baseButtonStatus;const a={...this.baseButtonStatus};return Object.values(p).forEach(r=>{a[r]=r===this.currentLoadingAction?"loading":"disable"}),a}handleClick(a){this.currentLoadingAction=a,this.emitAction(a)}};u([l({default:()=>[]})],c.prototype,"filingData",2);u([l({default:""})],c.prototype,"payApiUrl",2);u([l({default:!1})],c.prototype,"disableSaveResumeLater",2);u([l({default:!1})],c.prototype,"hasConflicts",2);u([l({default:!1})],c.prototype,"isLoading",2);u([l({default:"Confirm"})],c.prototype,"confirmLabel",2);u([l({default:""})],c.prototype,"errorMessage",2);u([l({default:!1})],c.prototype,"isSummaryMode",2);u([U("action")],c.prototype,"emitAction",1);u([b("isLoading")],c.prototype,"onIsLoadingChanged",1);c=u([g({components:{SbcFeeSummary:ae}})],c);var oe=function(){var t=this,a=t._self._c;return t._self._setupProxy,a("aside",{attrs:{id:"fee-summary"}},[a("SbcFeeSummary",{attrs:{filingData:[...t.filingData],payURL:t.payApiUrl}}),a("v-row",{attrs:{"no-gutters":""}},[t.isSummaryMode?a("v-col",{staticClass:"pt-3 px-1"},[a("v-btn",{attrs:{id:"back-btn",large:"",loading:t.buttonStatus[t.FeeSummaryActions.BACK]===t.ButtonState.LOADING,disabled:t.buttonStatus[t.FeeSummaryActions.BACK]===t.ButtonState.DISABLE},on:{click:function(r){return t.handleClick(t.FeeSummaryActions.BACK)}}},[a("span",[a("v-icon",[t._v("mdi-chevron-left")]),t._v("Back")],1)])],1):t._e(),a("v-col",{staticClass:"pt-3 px-1"},[a("v-btn",{attrs:{id:"cancel-btn",large:"",loading:t.buttonStatus[t.FeeSummaryActions.CANCEL]===t.ButtonState.LOADING,disabled:t.buttonStatus[t.FeeSummaryActions.CANCEL]===t.ButtonState.DISABLE},on:{click:function(r){return t.handleClick(t.FeeSummaryActions.CANCEL)}}},[a("span",[t._v("Cancel")])])],1),a("v-col",{staticClass:"pt-3 px-1"},[a("v-btn",{attrs:{id:"save-resume-later-btn",large:"",loading:t.buttonStatus[t.FeeSummaryActions.SAVE_RESUME_LATER]===t.ButtonState.LOADING,disabled:t.buttonStatus[t.FeeSummaryActions.SAVE_RESUME_LATER]===t.ButtonState.DISABLE},on:{click:function(r){return t.handleClick(t.FeeSummaryActions.SAVE_RESUME_LATER)}}},[a("span",[t._v("Save and Resume Later")])])],1),a("v-col",{staticClass:"pt-3 px-1"},[a("v-btn",{attrs:{id:"confirm-btn",large:"",loading:t.buttonStatus[t.FeeSummaryActions.CONFIRM]===t.ButtonState.LOADING,disabled:t.buttonStatus[t.FeeSummaryActions.CONFIRM]===t.ButtonState.DISABLE},on:{click:function(r){return t.handleClick(t.FeeSummaryActions.CONFIRM)}}},[a("span",[t._v(t._s(t.confirmLabel)),a("v-icon",[t._v("mdi-chevron-right")])],1)])],1)],1),t.errorMessage?a("div",{staticClass:"error-msg pre-wrap mt-1",domProps:{innerHTML:t._s(t.errorMessage)}}):t._e()],1)},ne=[],G=D(c,oe,ne,!1,null,"f1e3c04c",null,null);const ie=G.exports;G.exports.__docgenInfo={exportName:"default",displayName:"FeeSummary",description:"",tags:{},props:[{name:"filingData",tags:{},description:"Filing information to calculate fees.",type:{name:"Array",elements:[{name:"FilingDataIF"}]},defaultValue:{func:!0,value:"() => []"}},{name:"payApiUrl",tags:{},description:"URL for Sbc Fee Summary component to get fees.",type:{name:"string"},defaultValue:{func:!1,value:"''"}},{name:"disableSaveResumeLater",tags:{},description:"Whether to disable the Save and Resume Later button.",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"hasConflicts",tags:{},description:"Indicator that something isn't valid. This disables the confirm button.",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"isLoading",tags:{},description:"Indicator that there is a request in progress.",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"confirmLabel",tags:{},description:"Label for Confirm button.",type:{name:"string"},defaultValue:{func:!1,value:"'Confirm'"}},{name:"errorMessage",tags:{},description:"Message to display if there is an error.",type:{name:"string"},defaultValue:{func:!1,value:"''"}},{name:"isSummaryMode",tags:{},description:"Prop to indicate summary mode.",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}}],events:[{name:"action",description:"Emit action event."}],sourceFiles:["/home/severin/repos/bcrs-shared-components/src/components/fee-summary/FeeSummary.vue"]};N.filter("currency",e=>`$${e}`);const Re={title:"component/FeeSummary"},V=(e,{argTypes:t})=>({props:Object.keys(t),components:{FeeSummary:ie},template:'<div style="max-width: 316px"><fee-summary v-bind="$props" /></div>'}),x=[{filingTypeCode:M.ALTERATION,entityType:z.CORPORATION,priority:!1}],E=V.bind({});E.args={filingData:x,payApiUrl:"https://pay-api-dev.apps.silver.devops.gov.bc.ca/api/v1/",hasConflicts:!1,isLoading:!1,confirmLabel:"Continue",errorMessage:""};const O=V.bind({});O.args={filingData:x,payApiUrl:"https://pay-api-dev.apps.silver.devops.gov.bc.ca/api/v1/",hasConflicts:!1,isLoading:!1,confirmLabel:"File and Pay",errorMessage:"",isSummaryMode:!0};var d,I,y;E.parameters={...E.parameters,docs:{...(d=E.parameters)==null?void 0:d.docs,source:{originalSource:`(args, {
  argTypes
}) => ({
  props: Object.keys(argTypes),
  components: {
    FeeSummary
  },
  template: '<div style="max-width: 316px"><fee-summary v-bind="$props" /></div>' // $props comes from args below
})`,...(y=(I=E.parameters)==null?void 0:I.docs)==null?void 0:y.source}}};var L,C,h;O.parameters={...O.parameters,docs:{...(L=O.parameters)==null?void 0:L.docs,source:{originalSource:`(args, {
  argTypes
}) => ({
  props: Object.keys(argTypes),
  components: {
    FeeSummary
  },
  template: '<div style="max-width: 316px"><fee-summary v-bind="$props" /></div>' // $props comes from args below
})`,...(h=(C=O.parameters)==null?void 0:C.docs)==null?void 0:h.source}}};const ve=["Default","summaryMode"];export{E as Default,ve as __namedExportsOrder,Re as default,O as summaryMode};
//# sourceMappingURL=FeeSummary.stories-3f4c19fb.js.map
