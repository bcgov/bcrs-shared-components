<template>
  <v-form
    id="folio-number-form"
    ref="folioForm"
    v-model="folioFormValid"
  >
    <v-text-field
      id="folio-number-textfield"
      filled
      label="Folio Number (Optional)"
      :value="folioNumber"
      :rules="folioNumberRules"
      :disabled="disabled"
      autocomplete="chrome-off"
      :name="Math.random()"
      @input="emitFolioNumber($event)"
      @focus="emitFocus($event)"
    />
  </v-form>
</template>

<script lang="ts">
import Vue from 'vue'
import { Component, Prop, Watch, Emit } from 'vue-property-decorator'
import { FormIF } from '@bcrs-shared-components/interfaces'
import { VuetifyRuleFunction } from '@/types'

@Component({})
export default class FolioNumberInput extends Vue {
  $refs!: Vue['$refs'] & {
    folioForm: FormIF
  }

  /** Whether to validate the fields. */
  @Prop({ default: false }) readonly validate!: boolean

  /** Folio Number prop. */
  @Prop({ default: null }) readonly folioNumber!: string

  /** Disabled prop. */
  @Prop({ default: false }) readonly disabled!: boolean

  /** Folio form model property. */
  protected folioFormValid = false

  /** Validation rules for Folio Number. */
  get folioNumberRules (): Array<VuetifyRuleFunction> {
    return [
      v => (!v || !this.validate || v.length <= 50) || 'Cannot exceed 50 characters' // maximum character count
    ]
  }

  /** Emits an event indicating whether or not this component is valid. */
  @Emit('valid')
  private emitValid (): boolean {
    return this.folioFormValid
  }

  /** Emits an event indicating whether or not this component is focused. */
  @Emit('focus')
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  protected emitFocus (val: boolean): void {}

  /** Emits an event to update the Folio Number. */
  @Emit('emitFolioNumber')
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  protected emitFolioNumber (val: string): void {}

  /** Prompt the field validations. */
  @Watch('folioFormValid')
  @Watch('validate')
  private validateField (): void {
    if (this.validate) {
      this.validateFolioNumber()
      this.emitValid()
    }
  }

  /**
   * Public method that can be used through $refs from a parent
   * component to reset the folio form.
   */
  public resetFolioNumber (): void {
    this.$refs.folioForm.reset()
  }

  /**
   * Public method that can be used through $refs from a parent
   * component to reset folio number validation.
   */
  public resetFolioNumberValidation (): void {
    this.$refs.folioForm.resetValidation()
  }

  /**
   * Public method that can be used through $refs from a parent
   * component to trigger folio number validation.
   * @returns True if form is valid and False if not
   */
  public validateFolioNumber (): boolean {
    return this.$refs.folioForm.validate()
  }
}
</script>
